
## 三此握手过程


## 为什么需要三次握手

通过握手过程确认通信双方的数据原点的序列号

## 四次挥手的过程

因为TCP是全双工通道，所以哪一方都可以主动断开连接。

1. 客户端向服务端发送数据包，FIN=1、SEQ=u。告诉服务器，我没有数据要发送了。这时候客户端就进入了等待断开的第一阶段

2. 服务器向客户端发送ACK=1、seq=v、ack=u+1。表示，服务器告诉客户端，我已经知道你没有数据要发送了。

但是此时服务器可能仍然有数据要向客户端发送。

当服务端的数据也都发送完之后。

3. 这时，服务器会向客户端通知，服务端的数据也发送完了。

4. 客户端接到之后，向服务器发送报文，告诉服务器，客户端接到了通知。

5. 服务器接收到了响应，知道客户端已经知道了没有数据要接收了，服务端断开连接。

6. 客户端在发送了响应之后，等待2msl(最大报文段传输需要的时间长度)之后，断开连接。这是为了防止当客户端最后的一次响应服务端没有收到,服务端没有收到的时候会重新发送关闭请求。当这段时间没有重新收到服务端的关闭请求，客户端认为服务端已经接收到了自己的响应。所以自己可以断开了。

## TCP如何保证可靠交付

1. 序列号

    TCP进行传输的时候对字节进行编号，这个编号就是序列号

    这个序列号可以用于对数据进行分组。以及接收方通过序列号对数据进行排序

2. 确认应答

    收到数据后对发送方进行应答，告诉发送方收到的数据的序列号。发送方则下次数据发送从这个序列号之后开始。
    
3. 超时重发机制

    当发送方发送数据之后，等待一段时间仍然没有接受到接收方的ack应答。则认定这个数据包丢失，重新对这份数据进行发送

    这个超时时间是动态计算的。在Linux中是以500ms为单位控制的

4. 流量控制

...

