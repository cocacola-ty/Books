# IPA包大小优化点记录

1. 将图片资源放到`xcasset`中

    通过`assets`管理图片，这样打包上传App Store之后，用户下载时会根据用户的设备选择资源。也就是说，2倍屏的手机只下载2倍图，3倍屏的手机只下载3倍图。并且`assets`也会进行一个压缩。

    而如果放在bundle里面，则会将所有的图片资源都放到ipa包中下载下来。

    这项功能是iOS9之后才支持的。

    需要注意的是，当图片放到`assets`中后，加载图片只能通过`imageNamed:`方式。

2. 查找重复的图片并删除

    遍历工程中的所有图片文件。对图片文件进行MD5，将这个哈希值放到一个字典中。

    当哈希值相同时进行删除。

    这样的查找并不彻底。只能过滤出来完全相同的图片。对于图片样式相似但不是同一个文件的图片无法筛选出来。只能通过人工去找了。

    如果时间允许可以尝试使用`openCV`进行图片相似图检查筛选

3. 查找没有使用的图片并删除

    遍历工程中的所有图片，获取图片名

    遍历工程的代码文件，检查是否包含这个图片名。

4. 筛选图片体积大于50k的图片，进行压缩

5. 删除所有1x图

6. 移除体积较大的第三方库

7. 删除过期不再使用的类文件

    1. 首先删除该类文件名在代码中从未出现过的文件。可以直接删除

    2. 筛选只在`import`中出现过的文件名

8. 查找没有使用的方法

    简单的可以通过`AppCode`来查看，但是就得一个个文件去检查。

    或者通过分析`LinkMap`文件。`LinkMap`文件中`_Symbols`段是当前工程中所有编译后的方法列表

    通过`otool`反编译`__DATA_objc_selrefs`字段能拿到所有调用过的方法。